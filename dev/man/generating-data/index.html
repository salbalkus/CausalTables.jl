<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Generating data for statistical experiments · CausalTables.jl</title><meta name="title" content="Generating data for statistical experiments · CausalTables.jl"/><meta property="og:title" content="Generating data for statistical experiments · CausalTables.jl"/><meta property="twitter:title" content="Generating data for statistical experiments · CausalTables.jl"/><meta name="description" content="Documentation for CausalTables.jl."/><meta property="og:description" content="Documentation for CausalTables.jl."/><meta property="twitter:description" content="Documentation for CausalTables.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CausalTables.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../formatting/">Turning data into a <code>CausalTable</code></a></li><li class="is-active"><a class="tocitem" href>Generating data for statistical experiments</a><ul class="internal"><li><a class="tocitem" href="#Defining-a-DataGeneratingProcess"><span>Defining a DataGeneratingProcess</span></a></li><li><a class="tocitem" href="#Defining-a-StructuralCausalModel"><span>Defining a StructuralCausalModel</span></a></li><li><a class="tocitem" href="#Networks-of-Causally-Connected-Units"><span>Networks of Causally-Connected Units</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../estimands/">Approximating ground truth causal estimands</a></li><li><a class="tocitem" href="../ground-truth/">Computing ground truth conditional distributions</a></li><li><a class="tocitem" href="../network-summaries/">Network summaries</a></li><li><a class="tocitem" href="../api/">Full API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Generating data for statistical experiments</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Generating data for statistical experiments</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/salbalkus/CausalTables.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/salbalkus/CausalTables.jl/blob/main/docs/src/man/generating-data.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Generating-Data-for-Statistical-Experiments"><a class="docs-heading-anchor" href="#Generating-Data-for-Statistical-Experiments">Generating Data for Statistical Experiments</a><a id="Generating-Data-for-Statistical-Experiments-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-Data-for-Statistical-Experiments" title="Permalink"></a></h1><p>When evaluating a causal inference method, we often want to test it on data from a known causal model. CausalTables.jl allows us to define a <code>DataGeneratingProcess</code> (or DGP) to do just that. </p><h2 id="Defining-a-DataGeneratingProcess"><a class="docs-heading-anchor" href="#Defining-a-DataGeneratingProcess">Defining a DataGeneratingProcess</a><a id="Defining-a-DataGeneratingProcess-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-DataGeneratingProcess" title="Permalink"></a></h2><p>A data generating process describes a mechanism by which draws from random variables are simulated. It typically takes the form of a sequence of conditional distributions. CausalTables allows us to define a DGP as a DataGeneratingProcess object, which takes three arguments: the <code>names</code> of variables generated at each step, the <code>types</code> of these variables, and <code>funcs</code>, an array of functions of the form <code>O -&gt; *some code</code>. </p><p>Suppose, for example, that we wanted to simulate data from the following DGP:</p><p class="math-container">\[\begin{align*}
    W &amp;\sim \text{DiscreteUniform}(1, 5) \\
    X &amp;\sim \text{Normal}(W, 1) \\
    Y &amp;\sim \text{Normal}(X + 0.2W, 1)
\end{align*}\]</p><p>where <code>X</code> is the treatment, <code>Y</code> is the response, and <code>W</code> is a confounding variable affecting both X and Y. A verbose and inconvenient (albeit correct) way to define this DGP would be as follows:</p><pre><code class="language-julia hljs">using Distributions
using CausalTables

DataGeneratingProcess(
    [:W, :X, :Y],
    [
        O -&gt; DiscreteUniform(1, 5), 
        O -&gt; (@. Normal(O.W, 1)),
        O -&gt; (@. Normal(O.X + 0.2 * O.W, 1))
    ]
)</code></pre><p>where <code>O</code> is an object that stores the output of each previous function in the sequence as a field with a name corresponding to its order in the sequence (i.e. in this example, the first function&#39;s output is stored as <code>O.W</code>, the second function&#39;s output is stored as <code>O.X</code>, and so on).</p><p>However, a much more convenient way to define this DGP is using the <code>@dgp</code> macro, which takes a sequence of conditional distributions of the form <code>[variable name] ~ Distribution(args...)</code> and deterministic variable assignments of the form <code>[variable name] = f(...)</code> and automatically generates a valid DataGeneratingProcess. For example, the <em>easier</em> way to define the DGP above is as follows:</p><pre><code class="language-julia hljs">using CausalTables
distributions = @dgp(
        W ~ DiscreteUniform(1, 5),
        X ~ Normal.(W, 1),
        Y ~ (@. Normal(X + 0.2 * W, 1))
    )</code></pre><p>Note that when using the <code>@dgp</code> macro, any symbol defined on the left side of an equation in the sequence can be used to pass in the output of a previous step on the right side. For example, in the above code, the symbol <code>W</code> is used to pass in the output of the first step to the second step. This works by metaprogramming which replaces <code>W</code> with <code>O.W</code> when the function is constructed by <code>@dgp</code>. </p><p>In this way, we can define virtually any DGP that can be expressed as a sequence of conditional distributions. For ease of use, one can still use the <code>O</code> object in the <code>@dgp</code> macro to pass in the output of all previous steps, which is especially useful for programmatically-defined DGPs. For example, the following code is equivalent to the above code:</p><pre><code class="language-julia hljs">distributions = @dgp(
        W ~ DiscreteUniform(1, 5),
        X ~ Normal.(O[1], 1),
        Y ~ Normal.(hcat(values(O)...) * [1, 0.2], 1)
    )</code></pre><p>In the first step, previous variables are accessed by index using <code>O[1]</code>, and in the third step, all previous variables are combined into a matrix by <code>hcat(values(O)...)</code>. Be careful when using these constructions, however, as they can make the code harder to read and understand. In some cases, it may be better to construct a <code>DataGeneratingProcess</code> manually using the constructor, for which several additional utilities are available. </p><p>For instance, if one wanted to generate a large number of variables with the same distribution, one could use the <code>DataGeneratingProcess</code> constructor without specifying variable names, in which case names will be automatically generated:</p><pre><code class="language-julia hljs">many_distributions = DataGeneratingProcess(
    [O -&gt; Normal(0, 1) for _ in 1:100]
)</code></pre><p>In addition, the <code>merge</code> function can be used to combine two separate DGP sequences into one:</p><pre><code class="language-julia hljs"># Define a new distribution whose mean is the mean of previous draws
output_distribution = @dgp(
    Y ~ Normal.(reduce(+, values(O)) ./ n, 1)
)
# Merge our previous `many_distributions` with the new `output_distribution`
new_distributions = merge(many_distributions, output_distribution)</code></pre><h2 id="Defining-a-StructuralCausalModel"><a class="docs-heading-anchor" href="#Defining-a-StructuralCausalModel">Defining a StructuralCausalModel</a><a id="Defining-a-StructuralCausalModel-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-StructuralCausalModel" title="Permalink"></a></h2><p>In CausalTables.jl, a StructuralCausalModel is a data generating process endowed with some causal interpretation. Constructing a StructuralCausalModel allows users to randomly draw a CausalTable with the necessary components from the DataGeneratingProcess they&#39;ve defined. With the previous DataGeneratingProcess in hand, we can define a <code>StructuralCausalModel</code> object like so – treatment and response in the causal model are specified as keyword arguments to the <code>DataGeneratingProcess</code> constructor:</p><pre><code class="language-julia hljs">scm = StructuralCausalModel(
    distributions;
    treatment = :X,
    response = :Y
)</code></pre><p>When a <code>StructuralCausalModel</code> is constructed with only treatment and response specified, all other variables are assumed to be confounders. However, one can also explicitly specify the causes of both treatment and response by passing them as a <code>NamedTuple</code> of lists to the <code>StructuralCausalModel</code> constructor:</p><pre><code class="language-julia hljs">scm = StructuralCausalModel(
    distributions;
    treatment = :X,
    response = :Y,
    causes = (X = [:W], Y = [:X, :W])
)</code></pre><p>In the above, the keys of <code>causes</code> denote the variables whose causes are being specified, and the values are lists of variables that cause the key variable. In this case, the causes of the treatment <code>X</code> are specified as <code>[:W]</code>, and the causes of the response <code>Y</code> are specified as <code>[:X, :W]</code>, identical to how they are defined in a <a href="../formatting/">CausalTable object</a>. Just like for a <code>CausalTable</code>, while causes of other variables besides treatment and response can be specified, they are not necessary: only the causes of treatment and response are required as input. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p><code>causes</code> must be specified manually unless the user is assuming that all unlabeled variables cause both <code>treatment</code> and <code>outcome</code>. This is the default assumption of a <code>StructuralCausalModel</code>, but it may not not factually match the model encoded by the <code>DataGeneratingProcess</code>. This behavior is allowed for two reasons: (1) to permit a random draw of a <code>CausalTable</code> with an &#39;incorrect&#39; causal model, which can be useful for benchmarking the robustness of different causal inference methods to model misspecification, and (2) to simulate causal models that implicitly condition on a particular set of variables by leaving them out of the <code>causes</code> argument. Otherwise, ensure that labels in <code>causes</code> do not contradict the data generating process! </p></div></div><p>Finally, in some cases it may be convenient to define intermediate variables within a DGP</p><h2 id="Networks-of-Causally-Connected-Units"><a class="docs-heading-anchor" href="#Networks-of-Causally-Connected-Units">Networks of Causally-Connected Units</a><a id="Networks-of-Causally-Connected-Units-1"></a><a class="docs-heading-anchor-permalink" href="#Networks-of-Causally-Connected-Units" title="Permalink"></a></h2><p>In some cases, we might work with data in which units may <em>not</em> be causally independent, but rather, in which one unit&#39;s variables could dependent on some summary function of its neighbors. Generating data from such a model can be done by adding lines of the form <code>Xs $ NetworkSummary</code> to the <code>@dgp</code> macro.</p><p>Here&#39;s an example of how such a <code>StructuralCausalModel</code> might be constructed:</p><pre><code class="language-julia hljs">using Graphs
using CausalTables
using Distributions

dgp = @dgp(
        W ~ DiscreteUniform(1, 5),
        n = length(W),
        A = Graphs.adjacency_matrix(erdos_renyi(n, 0.5)),
        Ws $ Sum(:W, :A),
        X ~ (@. Normal(Ws, 1)),
        Xs $ Sum(:X, :A),
        Y ~ (@. Normal(Xs + 0.2 * Ws, 1))
    )

scm = StructuralCausalModel(
    dgp;
    treatment = :X,
    response = :Y
)</code></pre><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CausalTables.DataGeneratingProcess-man-generating-data" href="#CausalTables.DataGeneratingProcess-man-generating-data"><code>CausalTables.DataGeneratingProcess</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mutable struct DataGeneratingProcess</code></pre><p>A struct representing a data generating process.</p><p><strong>Fields</strong></p><ul><li><code>names</code>: An array of symbols representing the names of the variables.</li><li><code>types</code>: An array of symbols representing the types of the variables.</li><li><code>funcs</code>: An array of functions representing the generating functions for each variable.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/049b379032fe8997ae987602a746d61e0747bc1e/src/data_generating_process.jl#L51-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CausalTables.StructuralCausalModel-man-generating-data" href="#CausalTables.StructuralCausalModel-man-generating-data"><code>CausalTables.StructuralCausalModel</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct StructuralCausalModel</code></pre><p>A struct representing a structural causal model (SCM). This includes a DataGeneratingProcess </p><p><strong>Arguments</strong></p><ul><li><code>dgp::DataGeneratingProcess</code>: The data generating process from which random data will be drawn.</li><li><code>treatment::Vector{Symbol}</code>: The variables representing the treatment.</li><li><code>response::Vector{Symbol}</code>: The variables representing the response.</li><li><code>causes::Union{NamedTuple, Nothing}</code>: A NamedTuple of Vectors labeling the causes of relevant variables in the data-generating process. If <code>nothing</code>, will assume that all variables not contained in <code>treatment</code> or <code>response</code> are common causes of both.</li><li><code>arraynames</code>: Names of auxiliary variables used in the DataGeneratingProcess that are not included as &quot;tabular&quot; variables. Most commonly used to denote names of adjacency matrices used to compute summary functions of previous steps. </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/049b379032fe8997ae987602a746d61e0747bc1e/src/structural_causal_model.jl#L7-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.rand-Tuple{StructuralCausalModel, Int64}-man-generating-data" href="#Base.rand-Tuple{StructuralCausalModel, Int64}-man-generating-data"><code>Base.rand</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rand(scm::StructuralCausalModel, n::Int)</code></pre><p>Generate random data from a Structural Causal Model (SCM) using the specified number of samples.</p><p><strong>Arguments</strong></p><ul><li><code>scm::StructuralCausalModel</code>: The Structural Causal Model from which to generate data.</li><li><code>n::Int</code>: The number of samples to generate.</li></ul><p><strong>Returns</strong></p><p>A <code>CausalTable</code> object containing the generated data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/049b379032fe8997ae987602a746d61e0747bc1e/src/structural_causal_model.jl#L55-L67">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../formatting/">« Turning data into a <code>CausalTable</code></a><a class="docs-footer-nextpage" href="../estimands/">Approximating ground truth causal estimands »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 7 February 2025 01:51">Friday 7 February 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
