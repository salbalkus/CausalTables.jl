<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Computing ground truth conditional distributions · CausalTables.jl</title><meta name="title" content="Computing ground truth conditional distributions · CausalTables.jl"/><meta property="og:title" content="Computing ground truth conditional distributions · CausalTables.jl"/><meta property="twitter:title" content="Computing ground truth conditional distributions · CausalTables.jl"/><meta name="description" content="Documentation for CausalTables.jl."/><meta property="og:description" content="Documentation for CausalTables.jl."/><meta property="twitter:description" content="Documentation for CausalTables.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CausalTables.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../formatting/">Turning data into a <code>CausalTable</code></a></li><li><a class="tocitem" href="../generating-data/">Generating data for statistical experiments</a></li><li><a class="tocitem" href="../estimands/">Approximating ground truth causal estimands</a></li><li class="is-active"><a class="tocitem" href>Computing ground truth conditional distributions</a><ul class="internal"><li><a class="tocitem" href="#Intervening-on-a-CausalTable"><span>Intervening on a <code>CausalTable</code></span></a></li><li><a class="tocitem" href="#Obtaining-Conditional-Distributions-and-Functionals"><span>Obtaining Conditional Distributions and Functionals</span></a></li><li><a class="tocitem" href="#Implementing-Your-Own-Interventions"><span>Implementing Your Own Interventions</span></a></li><li><a class="tocitem" href="#Network-Summaries"><span>Network Summaries</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../network-summaries/">Network summaries</a></li><li><a class="tocitem" href="../api/">Full API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Computing ground truth conditional distributions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Computing ground truth conditional distributions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/salbalkus/CausalTables.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/salbalkus/CausalTables.jl/blob/main/docs/src/man/ground-truth.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Computing-Ground-Truth-Conditional-Distributions"><a class="docs-heading-anchor" href="#Computing-Ground-Truth-Conditional-Distributions">Computing Ground Truth Conditional Distributions</a><a id="Computing-Ground-Truth-Conditional-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Ground-Truth-Conditional-Distributions" title="Permalink"></a></h1><p>One main goal of CausalTables.jl is to allow statisticians to easily develop and test causal inference methods on simulated data. To this end, the package provides a way to compute &quot;ground truth&quot; causal quantities under a particular structural causal model (SCM) and intervention.</p><p>Quick methods to approximate the most common ground truth estimands such as the average treatment effect are provided in the section <a href="../estimands/">Approximating ground truth causal estimands</a>. However, in many cases it is also helpful to know the ground truth of more complicated functions of the data, such as conditional distributions, conditional means, or conditional variances. For example, if one is building a machine learning model to predict a conditional mean <span>$\mathbb{E}(Y \mid X = x)$</span> or a conditional density <span>$p(y \mid X = x)$</span>, it may be useful to know the true conditional mean to evaluate the model&#39;s performance. This section will explain how to compute these ground truth quantities using CausalTables.jl.</p><h2 id="Intervening-on-a-CausalTable"><a class="docs-heading-anchor" href="#Intervening-on-a-CausalTable">Intervening on a <code>CausalTable</code></a><a id="Intervening-on-a-CausalTable-1"></a><a class="docs-heading-anchor-permalink" href="#Intervening-on-a-CausalTable" title="Permalink"></a></h2><p>First, let us set up a simple example. First, we&#39;ll define a DGP using the <code>@dgp</code> macro and create a StructuralCausalModel object from it. This DGP contains a binary treatment <span>$A$</span> that depends on a continuous confounder <span>$W$</span> and a continuous outcome <span>$Y$</span> that depends on both <span>$A$</span> and <span>$W$</span>. </p><pre><code class="language-julia hljs">using CausalTables
using Random
using Distributions

# Define the sequence of random variables to be drawn
dgp = @dgp(
    W ~ Beta(2, 4),
    A ~ Bernoulli.(0.5 .* W .+ 0.2),
    Y ~ Normal.(W .+ A, 1)
)

scm = StructuralCausalModel(
    dgp;
    treatment = :A,
    response = :Y
)</code></pre><p>In the causal inference setting, we are typically concerned with outcomes under one or more interventions of interest. For example, for binary treatments, we often want to compare the outcome mean had every unit been treated versus had every unit not been treated. CausalTables.jl allows users to easily apply an intervention of interest to a given CausalTable, and subsequently compute counterfactual functions of interest, such as conditional means under intervention.</p><pre><code class="language-julia hljs"># Draw a random CausalTable from the StructuralCausalModel
Random.seed!(1);
ct = rand(scm, 500)

# Apply treated and untreated interventions to the CausalTable
ct_treated = intervene(ct, treat_all)
ct_untreated = intervene(ct, treat_none)</code></pre><p>To evaluate the causal effects of continuous treatments, one can apply the <code>additive_mtp</code> and <code>multiplicative_mtp</code> functions, which apply an additive or multiplicative shift, respectively, to the natural value of treatment. Their counterfactual differences (compared to the mean response in the source data) provide the causal analogues of a risk difference and risk ratio commonly estimated using linear models in scientific studies. </p><h2 id="Obtaining-Conditional-Distributions-and-Functionals"><a class="docs-heading-anchor" href="#Obtaining-Conditional-Distributions-and-Functionals">Obtaining Conditional Distributions and Functionals</a><a id="Obtaining-Conditional-Distributions-and-Functionals-1"></a><a class="docs-heading-anchor-permalink" href="#Obtaining-Conditional-Distributions-and-Functionals" title="Permalink"></a></h2><p>Once we&#39;ve defined an SCM (see <a href="../generating-data/">Generating data for statistical experiments</a>) and have some table of intervened data with variables matching those of our DGP, we can compute the ground truth conditional distributions of any variable (given a corresponding DGP) using the <code>condensity</code> function. For any line starting with a <code>~</code> in the DGP, <code>condensity</code> will be able to return the true conditional distribution, a Distribution object from the package <a href="https://juliastats.org/Distributions.jl/stable/">Distributions.jl</a>, given the data. Some examples are shown below:</p><pre><code class="language-julia hljs">
# Distribution of the treatment in the observed data
A_distribution = condensity(scm, ct, :A)

# Distribution of the outcome had everyone been treated
Y_under_treatment = condensity(scm, ct_treated, :Y)

# Distribution of the outcome had no one been treated
Y_under_treatment = condensity(scm, ct_untreated, :Y)</code></pre><p>One can also compute the ground truth of various functions of these distributions, including the conditional mean (<code>conmean</code>), conditional variance (<code>convar</code>), or propensity scores (<code>propensity</code>; this is the density function evaluated at the observed value of the given variable). To compute other functions of conditional densities not included in CausalTables.jl, please see <a href="https://juliastats.org/Distributions.jl/stable/">Distributions.jl</a>. Below, we show two examples of how one might compute an average treatment effect (ATE) using two different ground-truth functionals of the data.</p><pre><code class="language-julia hljs">### Plug-in Estimate ###
μ_treated = conmean(scm, ct_treated, :Y) 
μ_untreated = conmean(scm, ct_untreated, :Y) 
plugin = mean(μ_treated .- μ_untreated) 

### Inverse Propensity Weighted Estimate
p = propensity(scm, ct, :A) 
y = responsematrix(ct)
ipw = mean(y ./ p) .- mean(y)</code></pre><h2 id="Implementing-Your-Own-Interventions"><a class="docs-heading-anchor" href="#Implementing-Your-Own-Interventions">Implementing Your Own Interventions</a><a id="Implementing-Your-Own-Interventions-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-Your-Own-Interventions" title="Permalink"></a></h2><p>Forthcoming.</p><h2 id="Network-Summaries"><a class="docs-heading-anchor" href="#Network-Summaries">Network Summaries</a><a id="Network-Summaries-1"></a><a class="docs-heading-anchor-permalink" href="#Network-Summaries" title="Permalink"></a></h2><p>In causal inference settings featuring <em>network interference</em>, the outcome of one unit is not just affected by its own treatment, but also by some summary function of neighboring treatments. CausalTables.jl can also compute conditional densities for certain classes of summary functions. </p><p>If the StructuralCausalModel contains a summary function on a line starting with <code>$</code>, <code>condensity</code> will return the conditional distribution of the variable being summarized only if it admits a closed-form solution (otherwise an error will be thrown). Note that if the DGP attempts to summarize a variable with no neighbors in a graph, the resulting conditional distribution will currently be <code>Binomial(0, 0.5)</code>, which denotes a point-mass distribution at 0. Let&#39;s see an example.</p><pre><code class="language-julia hljs">using Graphs

dgp = @dgp(
        W ~ Binomial(10, 0.3),
        X ~ (@. Normal(W + 1)),
        A = Graphs.adjacency_matrix(barabasi_albert(length(X), 2)),
        Xs $ Sum(:X, :A),
        Y ~ (@. LogNormal(log(0.2 * Xs + 4), 0.1 * W + 1))
    )
scm = StructuralCausalModel(dgp; treatment = :X, response = :Y)

ct = rand(scm, 5)
W_distribution = condensity(scm, ct, :W)
X_distribution = condensity(scm, ct, :X)
Xs_distribution = condensity(scm, ct, :Xs)</code></pre><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CausalTables.condensity-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth" href="#CausalTables.condensity-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth"><code>CausalTables.condensity</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">condensity(scm::StructuralCausalModel, ct::CausalTable, name::Symbol)</code></pre><p>Compute the conditional density of variable <code>name</code> in CausalTable <code>ct</code> that has been drawn from StructuralCausalModel <code>scm</code>.</p><p><strong>Arguments</strong></p><ul><li><code>scm::StructuralCausalModel</code>: The StructuralCausalModel representing the data generating process.</li><li><code>ct::CausalTable</code>: The CausalTable containing the observed data.</li><li><code>name::Symbol</code>: The variable for which to compute the conditional density.</li></ul><p><strong>Returns</strong></p><p>The conditional density of the variable <code>var</code> given the observed data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/4296cffe151834f2b6b88b4089334a2bae1adb70/src/conditional_density.jl#L1-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CausalTables.conmean-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth" href="#CausalTables.conmean-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth"><code>CausalTables.conmean</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">conmean(scm::StructuralCausalModel, ct::CausalTable, name::Symbol)</code></pre><p>Compute the conditional mean of variable <code>name</code> in CausalTable <code>ct</code> that has been drawn from StructuralCausalModel <code>scm</code>.</p><p><strong>Arguments</strong></p><ul><li><code>scm::StructuralCausalModel</code>: The StructuralCausalModel object representing the data generating process.</li><li><code>ct::CausalTable</code>: The CausalTable object representing the data.</li><li><code>name::Symbol</code>: The variable for which to compute the conditional mean.</li></ul><p><strong>Returns</strong></p><p>An array of conditional means for the specified variable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/4296cffe151834f2b6b88b4089334a2bae1adb70/src/conditional_density.jl#L54-L67">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CausalTables.convar-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth" href="#CausalTables.convar-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth"><code>CausalTables.convar</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">convar(scm::StructuralCausalModel, ct::CausalTable, name::Symbol)</code></pre><p>Compute the conditional variance of variable <code>name</code> in CausalTable <code>ct</code> that has been drawn from StructuralCausalModel <code>scm</code>.</p><p><strong>Arguments</strong></p><ul><li><code>scm::StructuralCausalModel</code>: The StructuralCausalModel object representing the data generating process.</li><li><code>ct::CausalTable</code>: The CausalTable object representing the data.</li><li><code>name::Symbol</code>: The variable for which to compute the conditional mean.</li></ul><p><strong>Returns</strong></p><p>An array of conditional variances for the specified variable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/4296cffe151834f2b6b88b4089334a2bae1adb70/src/conditional_density.jl#L70-L83">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CausalTables.propensity-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth" href="#CausalTables.propensity-Tuple{StructuralCausalModel, CausalTable, Symbol}-man-ground-truth"><code>CausalTables.propensity</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">propensity(scm::StructuralCausalModel, ct::CausalTable, name::Symbol)</code></pre><p>Compute the (generalized) propensity score of variable <code>name</code> in CausalTable <code>ct</code> that has been drawn from StructuralCausalModel <code>scm</code>.</p><p><strong>Arguments</strong></p><ul><li><code>scm::StructuralCausalModel</code>: The StructuralCausalModel object representing the data generating process.</li><li><code>ct::CausalTable</code>: The CausalTable object representing the data.</li><li><code>name::Symbol</code>: The variable for which to compute the conditional mean.</li></ul><p><strong>Returns</strong></p><p>An array of conditional probabilities for the specified variable (or densities, if the specified variable is continuous).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/salbalkus/CausalTables.jl/blob/4296cffe151834f2b6b88b4089334a2bae1adb70/src/conditional_density.jl#L86-L99">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../estimands/">« Approximating ground truth causal estimands</a><a class="docs-footer-nextpage" href="../network-summaries/">Network summaries »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 7 February 2025 02:08">Friday 7 February 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
